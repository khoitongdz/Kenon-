-- Load UI Library (Fallback Safe)
local success, Fluent = pcall(function()
    return loadstring(game:HttpGet("https://raw.githubusercontent.com/khoitongdz/ui/refs/heads/main/.gitignore"))()
end)

if not success then
    warn("Failed to load Fluent UI. Aborting script.")
    return
end

-- Create Window
local Window = Fluent:CreateWindow({
    Title = "Kenon Hub",
    SubTitle = "Blox Fruits Script",
    TabWidth = 120,
    Size = UDim2.fromOffset(500, 350),
    Acrylic = false,
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.End
})

print([[ 
███████╗ █████╗ ███╗   ██╗
██╔════╝██╔══██╗████╗  ██║
█████╗  ███████║██╔██╗ ██║
██╔══╝  ██╔══██║██║╚██╗██║
███████╗██║  ██║██║ ╚████║
╚══════╝╚═╝  ╚═╝╚═╝  ╚═══╝
]])
print("🔥 Kenon Hub for Blox Fruits 🔥")

-- Services and Player Setup
local player = game.Players.LocalPlayer
local replicatedStorage = game:GetService("ReplicatedStorage")
local workspaceEnemies = game.Workspace:WaitForChild("Enemies")

-- Global Toggles
_G.AutoBone = false

-- Functions
local function findNearestEnemy()
    local closestEnemy = nil
    local shortestDistance = math.huge

    for _, enemy in pairs(workspaceEnemies:GetChildren()) do
        if enemy:FindFirstChild("HumanoidRootPart") and enemy:FindFirstChild("Humanoid") and enemy.Humanoid.Health > 0 then
            local distance = (enemy.HumanoidRootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude
            if distance < shortestDistance then
                closestEnemy = enemy
                shortestDistance = distance
            end
        end
    end

    return closestEnemy
end

local function attackEnemy(target)
    if replicatedStorage:FindFirstChild("RemoteEvent") then
        replicatedStorage.RemoteEvent:FireServer("Attack", target)
    else
        warn("RemoteEvent not found!")
    end
end

local function teleportToLocation(locationCFrame)
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        player.Character.HumanoidRootPart.CFrame = locationCFrame
    end
end

-- Auto Farm Logic
local function autoFarmBone()
    spawn(function()
        while _G.AutoBone do
            pcall(function()
                -- Bone Farming Locations
                local BoneCFrame = CFrame.new(-9515.75, 174.85, 6079.4)
                local BoneCFrame2 = CFrame.new(-9359.45, 141.32, 5446.81)

                -- Teleport and Start Quest
                local questTitle = player.PlayerGui.Main.Quest.Container.QuestTitle.Title.Text
                if not string.find(questTitle, "Demonic Soul") then
                    replicatedStorage.Remotes.CommF_:InvokeServer("AbandonQuest")
                end

                -- Determine Location
                if (player.Character.HumanoidRootPart.Position - BoneCFrame.Position).Magnitude > 1000 then
                    teleportToLocation(BoneCFrame)
                elseif (player.Character.HumanoidRootPart.Position - BoneCFrame2.Position).Magnitude < 1000 then
                    teleportToLocation(BoneCFrame2)
                end

                -- Quest Start
                if (player.Character.HumanoidRootPart.Position - BoneCFrame.Position).Magnitude <= 5 then
                    replicatedStorage.Remotes.CommF_:InvokeServer("StartQuest", "HauntedQuest2", 1)
                end

                -- Attack Enemies
                for _, enemy in pairs(workspaceEnemies:GetChildren()) do
                    if enemy:FindFirstChild("HumanoidRootPart") and enemy:FindFirstChild("Humanoid") and enemy.Humanoid.Health > 0 then
                        if enemy.Name == "Reborn Skeleton" or enemy.Name == "Living Zombie" or enemy.Name == "Demonic Soul" or enemy.Name == "Posessed Mummy" then
                            attackEnemy(enemy)
                        end
                    end
                end
            end)
            wait(0.1)
        end
    end)
end

-- UI Toggle for Auto Farm Bone
local farmingTab = Window:AddTab("Farming")
farmingTab:AddToggle("Auto Farm Bone", {
    Title = "Enable Auto Farm Bone",
    Default = false,
    Callback = function(value)
        _G.AutoBone = value
        if value then
            autoFarmBone()
        end
    end
})

-- Final Touches
Window:Show()

print("Kenon Hub initialized! Use the UI menu to enable features.")
